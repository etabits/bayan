mixin schemaForm(s, data={},prefix='form')
  form(method='post', target='tgt')&attributes(attributes)
    .card
      .card-content
        +schemaFields(s.attributes, data, prefix)
      .card-action
        button.btn.waves-effect.waves-light(type='submit')
          | Submit
          i.material-icons.right send
  pre: code!=JSON.stringify(s, null, 4)

mixin schemaFields(fields, data, prefix)
  each attr, attrName in fields
    - var id = prefix+'.'+attrName
    - console.log(id, attrName, data)
    +field(attr, data && data[attrName], id)

mixin field_bare(attr, data, id)
  if pug_mixins['_' + attr.fieldType]
    !=`<!-- ${id}(${attr.fieldType}) -->`
    +#{'_' + attr.fieldType}(attr, data, id)
  else
    p: em _#{attr.fieldType} is not implemented yet...

mixin field(attr, data, id)
  - var wrapperOptions = {id}
  if 'object' == attr.fieldType || 'array' == attr.fieldType
    - wrapperOptions.header =attr.label
    - wrapperOptions.classes = ''
  else if 'boolean' !== attr.fieldType
    - wrapperOptions.label = attr.label
    - wrapperOptions.classes = 'input-field'
  +field_wrapper(wrapperOptions)
    +field_bare(attr, data, id)

mixin _string(attr, data, id)
  - console.log('>', data)
  input.validate(id=id, name=id, type='text',value=data,placeholder=attr.placeholder)&attributes(attributes)

mixin _date(attr, data, id)
  +_string(attr, data, id)(type='date',class='datepicker')

mixin _number(attr, data, id)
  +_string(attr, data, id)(type='number')

mixin _object(attr, data, id)
  +schemaFields(attr.extendedType, data, id)

mixin _array(attr, data, id)
  .bayan-template(id='bayan-template-'+id,data-next-number=data? data.length : 1)
    +array_element(attr.extendedType[0], null, id, '{NUM}')

  if data && data.length
    each val,index in data
      +array_element(attr.extendedType[0], val, id, index)
  else
      +array_element(attr.extendedType[0], null, id, 0)

  div.right-align.bayan-add-array-element.teal
    button.btn-floating.waves-effect.waves-light.white(type='button',onclick='Bayan.UI.arrayAdd(this)')
      i.material-icons.teal-text add

mixin array_element(attr, data, id, num)
  div(class=('{NUM}'==num)?'bayan-array-template':'bayan-array-element')
    .row
      .col.s3.m2.l1
        .bayan-array-number.valign-wrapper
          button.valign.btn-floating.btn-flat(type='button',tabindex=-1,onclick='Bayan.UI.arrayDel(this)')
            i.material-icons delete
      .col.s9.m10.l11
        +field_bare(attr, data, id+'.'+num)

mixin _boolean(attr, data, id)
  .switch
    label
      | #{attr.label}: No
      input(id=id, name=id, type='checkbox',checked=!!data)
      span.lever
      | Yes

mixin field_wrapper(opts={})
  if opts.header
    .bayan-sub-container
      .bayan-sub-header=opts.header
      .bayan-sub-content
        +_field_wrapper(opts)
          block
  else
    .row
      .col.s12(class=opts.classes)
        +_field_wrapper(opts)
          block

mixin _field_wrapper(opts)
  if opts.label
    label(for=opts.id)=opts.label
  block
